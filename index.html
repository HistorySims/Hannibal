<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Second Punic War â€“ Debug Grid</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#020617;
  font-family: ui-monospace, Menlo, Consolas, monospace;
  overflow:hidden;
}

canvas{
  width:100vw;
  height:100vh;
  display:block;
  image-rendering: pixelated;
  cursor: crosshair; /* Helps with targeting */
}

#hud{
  position:fixed;
  top:0; left:0; right:0;
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:#fbbf24;
  background:linear-gradient(to bottom, rgba(2,6,23,0.85), rgba(2,6,23,0));
  pointer-events:none;
}

#debug-info {
    position: fixed;
    bottom: 10px;
    right: 10px;
    color: #ef4444;
    background: rgba(0,0,0,0.8);
    padding: 8px;
    border: 1px solid #ef4444;
    font-size: 14px;
    pointer-events: none;
}
</style>
</head>

<body>

<canvas id="c"></canvas>

<div id="hud">
  <div>DEBUG MODE</div>
  <div>Grid Overlay</div>
</div>

<div id="debug-info">Hover for coords</div>

<script>
/* ===================== CONFIG ===================== */

const MAP_SRC = "IMG_4198.jpeg"; 
const STORAGE_KEY = "spw_campaign_progress_v1";

// Current (wrong) positions - we will fix these next!
const battles = [
  { id:"trebia",  name:"Trebia",         x:0.58, y:0.26 },
  { id:"tras",    name:"Lake Trasimene", x:0.50, y:0.36 },
  { id:"fabian",  name:"Fabian Tactics", x:0.54, y:0.42 },
  { id:"cannae",  name:"Cannae",         x:0.63, y:0.52 },
  { id:"zama",    name:"Zama",           x:0.34, y:0.74 } 
];

/* ===================== SETUP ===================== */

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const debugDiv = document.getElementById("debug-info");

ctx.imageSmoothingEnabled = false;

let mapImg = new Image();
mapImg.src = MAP_SRC;

let mouseX = 0;
let mouseY = 0;

function resize(){
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
  draw();
}
window.addEventListener("resize", resize);

/* ===================== DRAW GRID & DEBUG ===================== */

function drawGrid() {
    ctx.lineWidth = 1;
    ctx.font = "10px monospace";
    ctx.textAlign = "left";

    // Draw Vertical Lines (X)
    for(let i=0; i<=10; i++){
        let x = (i/10) * canvas.width;
        ctx.strokeStyle = "rgba(255,255,255,0.2)";
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
        
        // Label
        ctx.fillStyle = "rgba(255,255,255,0.5)";
        ctx.fillText("x:"+ (i/10).toFixed(1), x + 2, 12);
    }

    // Draw Horizontal Lines (Y)
    for(let i=0; i<=10; i++){
        let y = (i/10) * canvas.height;
        ctx.strokeStyle = "rgba(255,255,255,0.2)";
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();

        // Label
        ctx.fillStyle = "rgba(255,255,255,0.5)";
        ctx.fillText("y:"+ (i/10).toFixed(1), 5, y - 2);
    }
}

function drawCursorCoords() {
    // Draw crosshair at mouse
    const x = mouseX * canvas.width;
    const y = mouseY * canvas.height;

    ctx.strokeStyle = "#ef4444";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x - 10, y);
    ctx.lineTo(x + 10, y);
    ctx.moveTo(x, y - 10);
    ctx.lineTo(x, y + 10);
    ctx.stroke();

    // Update the floating debug box
    debugDiv.textContent = `X: ${mouseX.toFixed(2)} | Y: ${mouseY.toFixed(2)}`;
}

/* ===================== MAIN DRAW ===================== */

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 1. Draw Map
  if(mapImg.complete) {
      ctx.drawImage(mapImg, 0,0, canvas.width, canvas.height);
  }

  // 2. Draw the Grid
  drawGrid();

  // 3. Draw existing markers (so you can see how far off they are)
  battles.forEach((b)=>{
    const x = b.x*canvas.width;
    const y = b.y*canvas.height;
    
    // Draw marker
    ctx.fillStyle = "rgba(251,191,36,0.5)";
    ctx.fillRect(x-6,y-18,12,36);
    ctx.fillRect(x-18,y-6,36,12);
    
    // Label
    ctx.fillStyle="#fff";
    ctx.font="12px ui-monospace";
    ctx.textAlign="center";
    ctx.fillText(b.name,x,y-22);
  });

  // 4. Draw Mouse tracker
  drawCursorCoords();
}

mapImg.onload = draw;

/* ===================== INTERACTION ===================== */

// Track mouse/touch movement for coordinates
function updateCoords(clientX, clientY) {
    const r = canvas.getBoundingClientRect();
    mouseX = (clientX - r.left) / r.width;
    mouseY = (clientY - r.top) / r.height;
    requestAnimationFrame(draw);
}

canvas.addEventListener("mousemove", e => updateCoords(e.clientX, e.clientY));
canvas.addEventListener("touchmove", e => {
    e.preventDefault(); // stop scrolling while debugging
    updateCoords(e.touches[0].clientX, e.touches[0].clientY);
}, {passive: false});

// Initial draw
resize();

</script>
</body>
</html>
